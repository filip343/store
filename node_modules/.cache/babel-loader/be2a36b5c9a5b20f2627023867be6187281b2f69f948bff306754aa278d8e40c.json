{"ast":null,"code":"import { auth } from \"./firebase\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, signInWithRedirect, GoogleAuthProvider, getRedirectResult } from \"firebase/auth\";\nconst addUser = uid => {\n  const options = {\n    method: \"POST\",\n    body: JSON.stringify({\n      uid: uid,\n      cart: []\n    }),\n    headers: {\n      'Access-Control-Allow-Origin': \"http://localhost:3000\",\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  fetch('http://localhost:8080/user', options).then(res => {\n    return res.json();\n  }).then(res => {\n    localStorage.setItem('userData', JSON.stringify({\n      _id: res.insertedId,\n      cart: [],\n      uid: uid\n    }));\n    localStorage.setItem(\"cart\", JSON.stringify([]));\n  }).catch(err => {\n    console.log(JSON.parse(err));\n  });\n};\nconst getUserData = uid => {\n  const options = {\n    method: \"GET\",\n    headers: {\n      'Access-Control-Allow-Origin': \"http://localhost:3000\",\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  fetch(`http://localhost:8080/user/${uid}`, options).then(res => {\n    return res.json();\n  }).then(res => {\n    localStorage.setItem(\"userData\", JSON.stringify(res));\n    localStorage.setItem(\"cart\", JSON.stringify(res.cart));\n  }).catch(err => {\n    console.log(err);\n  });\n};\nexport const doCreateUserWithEmailAndPassword = async (email, password) => {\n  createUserWithEmailAndPassword(auth, email, password).then(res => {\n    addUser(res.user.uid);\n    window.location.pathname = \"\";\n  }).catch(err => {\n    console.log(err.code);\n  }); //TODO:make error handling\n};\n\nexport const doSignInWithEmailAndPassword = async (email, password) => {\n  signInWithEmailAndPassword(auth, email, password).then(res => {\n    getUserData(res.user.uid);\n    window.location.pathname = \"\";\n  });\n};\nexport const doSignInWithGoogle = async () => {\n  const provider = new GoogleAuthProvider();\n  if (!localStorage.getItem('isMobile')) {\n    signInWithPopup(auth, provider).then(result => {\n      const credentials = GoogleAuthProvider.credentialFromResult(result);\n      console.log(credentials);\n      const token = credentials === null || credentials === void 0 ? void 0 : credentials.accessToken;\n    }).catch(error => {\n      var _error$customData;\n      const errorCode = error.code;\n      const errorMessage = error.message;\n      const email = (_error$customData = error.customData) === null || _error$customData === void 0 ? void 0 : _error$customData.email;\n      const credentials = GoogleAuthProvider.credentialFromError(error);\n    });\n  } else {\n    signInWithRedirect(auth, provider);\n    getRedirectResult(auth).then(result => {\n      if (result) {\n        const credentials = GoogleAuthProvider.credentialFromResult(result);\n        console.log(credentials);\n        const token = credentials === null || credentials === void 0 ? void 0 : credentials.accessToken;\n        const user = result.user;\n      }\n    }).catch(error => {\n      const errorCode = error.code;\n      const errorMessage = error.message;\n      const email = error.customData.email;\n      const credentials = GoogleAuthProvider.credentialFromError(error);\n    });\n  }\n};\nexport const doSignOut = () => {\n  return auth.signOut().then(() => {\n    localStorage.setItem(\"userData\", null);\n    localStorage.setItem(\"cart\", []);\n  });\n};","map":{"version":3,"names":["auth","createUserWithEmailAndPassword","signInWithEmailAndPassword","signInWithPopup","signInWithRedirect","GoogleAuthProvider","getRedirectResult","addUser","uid","options","method","body","JSON","stringify","cart","headers","fetch","then","res","json","localStorage","setItem","_id","insertedId","catch","err","console","log","parse","getUserData","doCreateUserWithEmailAndPassword","email","password","user","window","location","pathname","code","doSignInWithEmailAndPassword","doSignInWithGoogle","provider","getItem","result","credentials","credentialFromResult","token","accessToken","error","_error$customData","errorCode","errorMessage","message","customData","credentialFromError","doSignOut","signOut"],"sources":["C:/Users/PC/Desktop/sklep/code/site_/src/firebase/auth.js"],"sourcesContent":["import { auth } from \"./firebase\";\r\nimport { createUserWithEmailAndPassword,signInWithEmailAndPassword,signInWithPopup,signInWithRedirect,GoogleAuthProvider, getRedirectResult } from \"firebase/auth\";\r\n\r\n\r\n\r\nconst addUser = (uid)=>{\r\n  const options = {    method: \"POST\", \r\n  body:JSON.stringify({\r\n    uid:uid,\r\n    cart:[]\r\n  }), \r\n  headers: {\r\n    'Access-Control-Allow-Origin':\"http://localhost:3000\",\r\n    \"Content-Type\": \"application/json\"\r\n  }};\r\n  fetch('http://localhost:8080/user',options).then((res)=>{\r\n    return res.json();\r\n\r\n  }).then(res=>{\r\n    localStorage.setItem('userData',JSON.stringify({_id:res.insertedId,cart:[],uid:uid}))\r\n    localStorage.setItem(\"cart\",JSON.stringify([]))\r\n  }).catch((err)=>{console.log(JSON.parse(err));});\r\n\r\n}\r\nconst getUserData = (uid)=>{\r\n  const options = {    method: \"GET\", \r\n  headers: {\r\n    'Access-Control-Allow-Origin':\"http://localhost:3000\",\r\n    \"Content-Type\": \"application/json\"\r\n  }};\r\n\r\n  fetch(`http://localhost:8080/user/${uid}`,options).then((res)=>{\r\n    return res.json();\r\n\r\n  }).then(res=>{\r\n    \r\n    localStorage.setItem(\"userData\",JSON.stringify(res));\r\n    localStorage.setItem(\"cart\",JSON.stringify(res.cart));\r\n    \r\n  }).catch((err)=>{\r\n    console.log(err);\r\n  });\r\n\r\n}\r\n\r\n\r\n\r\nexport const doCreateUserWithEmailAndPassword=async(email,password)=>{\r\n  \r\n  createUserWithEmailAndPassword(auth,email,password)\r\n  .then(res=>{\r\n    addUser(res.user.uid);\r\n    window.location.pathname=\"\";\r\n  })\r\n  .catch(err=>{console.log(err.code)});//TODO:make error handling\r\n}\r\nexport const doSignInWithEmailAndPassword=async(email,password)=>{\r\n  signInWithEmailAndPassword(auth,email,password)\r\n  .then((res)=>{\r\n    getUserData(res.user.uid);\r\n    window.location.pathname=\"\";\r\n  });\r\n}\r\n\r\nexport const doSignInWithGoogle = async()=>{\r\n  const provider = new GoogleAuthProvider();\r\n  if(!localStorage.getItem('isMobile')){\r\n    signInWithPopup(auth,provider)\r\n    .then(result=>{\r\n      const credentials = GoogleAuthProvider.credentialFromResult(result);\r\n      console.log(credentials);\r\n      const token = credentials?.accessToken;\r\n\r\n\r\n    }).catch(error=>{\r\n      const errorCode = error.code;\r\n      const errorMessage = error.message;\r\n      const email = error.customData?.email;\r\n      const credentials = GoogleAuthProvider.credentialFromError(error)\r\n    })\r\n  }else{\r\n    signInWithRedirect(auth,provider);\r\n    getRedirectResult(auth)\r\n    .then(result=>{\r\n      if(result){\r\n        const credentials = GoogleAuthProvider.credentialFromResult(result);\r\n        console.log(credentials);\r\n        const token = credentials?.accessToken;\r\n\r\n        const user = result.user;\r\n      }\r\n    }).catch(error=>{\r\n      const errorCode = error.code;\r\n      const errorMessage = error.message;\r\n      const email = error.customData.email;\r\n      const credentials = GoogleAuthProvider.credentialFromError(error);\r\n    })\r\n  }\r\n}\r\n\r\nexport const doSignOut=()=>{\r\n  return auth.signOut().then(()=>{\r\n    localStorage.setItem(\"userData\",null);\r\n    localStorage.setItem(\"cart\",[]);\r\n  });\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}