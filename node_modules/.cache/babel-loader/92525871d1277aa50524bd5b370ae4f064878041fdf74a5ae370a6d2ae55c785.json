{"ast":null,"code":"import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signInWithPopup,signInWithRedirect,GoogleAuthProvider,getRedirectResult}from\"firebase/auth\";import{auth}from'./firebase';const addUser=uid=>{const options={method:\"POST\",body:JSON.stringify({uid:uid,cart:[]}),headers:{'Access-Control-Allow-Origin':\"http://localhost:3000\",\"Content-Type\":\"application/json\"}};fetch('http://localhost:8080/user',options).then(res=>{return res.json();}).then(res=>{localStorage.setItem('userData',JSON.stringify({_id:res.insertedId,cart:[],uid:uid}));localStorage.setItem(\"cart\",JSON.stringify([]));}).catch(err=>{console.log(JSON.parse(err));});};const getUserData=uid=>{const options={method:\"GET\",headers:{'Access-Control-Allow-Origin':\"http://localhost:3000\",\"Content-Type\":\"application/json\"}};fetch(\"http://localhost:8080/user/\".concat(uid),options).then(res=>{return res.json();}).then(res=>{localStorage.setItem(\"userData\",JSON.stringify(res));localStorage.setItem(\"cart\",JSON.stringify(res.cart));}).catch(err=>{console.log(err);});};export const doCreateUserWithEmailAndPassword=async(email,password)=>{createUserWithEmailAndPassword(auth,email,password).then(res=>{addUser(res.user.uid);window.location.pathname=\"\";}).catch(err=>{console.log(err.code);});//TODO:make error handling\n};export const doSignInWithEmailAndPassword=async(email,password)=>{signInWithEmailAndPassword(auth,email,password).then(res=>{getUserData(res.user.uid);window.location.pathname=\"\";});};export const doSignInWithGoogle=async()=>{const provider=new GoogleAuthProvider();if(!localStorage.getItem('isMobile')){signInWithPopup(auth,provider).then(result=>{const credentials=GoogleAuthProvider.credentialFromResult(result);console.log(credentials);const token=credentials===null||credentials===void 0?void 0:credentials.accessToken;}).catch(error=>{var _error$customData;const errorCode=error.code;const errorMessage=error.message;const email=(_error$customData=error.customData)===null||_error$customData===void 0?void 0:_error$customData.email;const credentials=GoogleAuthProvider.credentialFromError(error);});}else{signInWithRedirect(auth,provider);getRedirectResult(auth).then(result=>{if(result){const credentials=GoogleAuthProvider.credentialFromResult(result);console.log(credentials);const token=credentials===null||credentials===void 0?void 0:credentials.accessToken;const user=result.user;}}).catch(error=>{const errorCode=error.code;const errorMessage=error.message;const email=error.customData.email;const credentials=GoogleAuthProvider.credentialFromError(error);});}};export const doSignOut=()=>{return auth.signOut().then(()=>{localStorage.setItem(\"userData\",null);localStorage.setItem(\"cart\",\"\");});};","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signInWithPopup","signInWithRedirect","GoogleAuthProvider","getRedirectResult","auth","addUser","uid","options","method","body","JSON","stringify","cart","headers","fetch","then","res","json","localStorage","setItem","_id","insertedId","catch","err","console","log","parse","getUserData","concat","doCreateUserWithEmailAndPassword","email","password","user","window","location","pathname","code","doSignInWithEmailAndPassword","doSignInWithGoogle","provider","getItem","result","credentials","credentialFromResult","token","accessToken","error","_error$customData","errorCode","errorMessage","message","customData","credentialFromError","doSignOut","signOut"],"sources":["C:/Users/PC/Desktop/sklep/code/site_/src/firebase/auth.js"],"sourcesContent":["import { createUserWithEmailAndPassword,signInWithEmailAndPassword,signInWithPopup,signInWithRedirect,GoogleAuthProvider, getRedirectResult } from \"firebase/auth\";\r\nimport {auth} from './firebase'\r\n\r\n\r\n\r\nconst addUser = (uid)=>{\r\n  const options = {    method: \"POST\", \r\n  body:JSON.stringify({\r\n    uid:uid,\r\n    cart:[]\r\n  }), \r\n  headers: {\r\n    'Access-Control-Allow-Origin':\"http://localhost:3000\",\r\n    \"Content-Type\": \"application/json\"\r\n  }};\r\n  fetch('http://localhost:8080/user',options).then((res)=>{\r\n    return res.json();\r\n\r\n  }).then(res=>{\r\n    localStorage.setItem('userData',JSON.stringify({_id:res.insertedId,cart:[],uid:uid}))\r\n    localStorage.setItem(\"cart\",JSON.stringify([]))\r\n  }).catch((err)=>{console.log(JSON.parse(err));});\r\n\r\n}\r\nconst getUserData = (uid)=>{\r\n  const options = {    method: \"GET\", \r\n  headers: {\r\n    'Access-Control-Allow-Origin':\"http://localhost:3000\",\r\n    \"Content-Type\": \"application/json\"\r\n  }};\r\n\r\n  fetch(`http://localhost:8080/user/${uid}`,options).then((res)=>{\r\n    return res.json();\r\n\r\n  }).then(res=>{\r\n    \r\n    localStorage.setItem(\"userData\",JSON.stringify(res));\r\n    localStorage.setItem(\"cart\",JSON.stringify(res.cart));\r\n    \r\n  }).catch((err)=>{\r\n    console.log(err);\r\n  });\r\n\r\n}\r\n\r\n\r\n\r\nexport const doCreateUserWithEmailAndPassword=async(email,password)=>{\r\n  \r\n  createUserWithEmailAndPassword(auth,email,password)\r\n  .then(res=>{\r\n    addUser(res.user.uid);\r\n    window.location.pathname=\"\";\r\n  })\r\n  .catch(err=>{console.log(err.code)});//TODO:make error handling\r\n}\r\nexport const doSignInWithEmailAndPassword=async(email,password)=>{\r\n  signInWithEmailAndPassword(auth,email,password)\r\n  .then((res)=>{\r\n    getUserData(res.user.uid);\r\n    window.location.pathname=\"\";\r\n  });\r\n}\r\n\r\nexport const doSignInWithGoogle = async()=>{\r\n  const provider = new GoogleAuthProvider();\r\n  if(!localStorage.getItem('isMobile')){\r\n    signInWithPopup(auth,provider)\r\n    .then(result=>{\r\n      const credentials = GoogleAuthProvider.credentialFromResult(result);\r\n      console.log(credentials);\r\n      const token = credentials?.accessToken;\r\n\r\n\r\n    }).catch(error=>{\r\n      const errorCode = error.code;\r\n      const errorMessage = error.message;\r\n      const email = error.customData?.email;\r\n      const credentials = GoogleAuthProvider.credentialFromError(error)\r\n    })\r\n  }else{\r\n    signInWithRedirect(auth,provider);\r\n    getRedirectResult(auth)\r\n    .then(result=>{\r\n      if(result){\r\n        const credentials = GoogleAuthProvider.credentialFromResult(result);\r\n        console.log(credentials);\r\n        const token = credentials?.accessToken;\r\n\r\n        const user = result.user;\r\n      }\r\n    }).catch(error=>{\r\n      const errorCode = error.code;\r\n      const errorMessage = error.message;\r\n      const email = error.customData.email;\r\n      const credentials = GoogleAuthProvider.credentialFromError(error);\r\n    })\r\n  }\r\n}\r\n\r\nexport const doSignOut=()=>{\r\n  return auth.signOut().then(()=>{\r\n    localStorage.setItem(\"userData\",null);\r\n    localStorage.setItem(\"cart\",\"\");\r\n  });\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}